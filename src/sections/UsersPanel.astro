---
import CreateUserModalButton from "@/components/CreateUserModalButton.astro"
import UsersTable from "@/components/UsersTable.astro"
---

<section class="px-12 mt-12 text-stone-800 dark:text-stone-200">
    <header class="flex justify-between">
        <h2 class="font-bold text-4xl">Gesti√≥n de usuarios</h2>
        <CreateUserModalButton>
            + Agregar usuario
        </CreateUserModalButton>
    </header>
    <UsersTable class="mt-14" server:defer>
        <div slot="fallback" class="mt-14 min-h-4xl w-full flex justify-center items-center">
            <h1 class="text-stone-200 font-semibold text-4xl">Cargando...</h1>
        </div>
    </UsersTable>
</section>

<script>
    document.addEventListener('click', (e) => {
        const clickedElement = e.target as HTMLElement
        const dotsButton = clickedElement.closest(".dots-menu") as HTMLElement | null
        const allMenus = document.querySelectorAll(".menu")

        if (!dotsButton) {
            allMenus.forEach(menu => {
                menu.classList.add("hidden")
                menu.classList.remove("flex")
            })
            return
        }
        
        const currentMenu = dotsButton.parentElement?.querySelector('.menu') as HTMLElement
        if (!currentMenu) return
        
        allMenus.forEach(menu => {
            if (menu !== currentMenu) {
                menu.classList.add("hidden")
                menu.classList.remove("flex")
            }
        })
        
        currentMenu.classList.toggle('hidden')
        currentMenu.classList.toggle('flex')
    })
</script>
